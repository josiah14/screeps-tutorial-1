{"version":3,"sources":["game/market.js"],"names":["_","require","utils","driver","getDriver","C","constants","util","exports","make","runtimeData","intents","register","ordersCreatedDuringTick","cachedOrders","_incomingTransactions","_outgoingTransactions","_orders","_getOrders","resourceType","contains","RESOURCES_ALL","SUBSCRIPTION_TOKEN","JSON","parse","stringify","market","orders","calcTransactionCost","wrapFn","amount","roomName1","roomName2","distance","calcRoomsDistance","calcTerminalEnergyCost","getAllOrders","filter","getOrderById","id","all","createOrder","type","price","totalAmount","roomName","ERR_INVALID_ARGS","ORDER_BUY","ORDER_SELL","parseFloat","parseInt","MARKET_FEE","credits","ERR_NOT_ENOUGH_RESOURCES","any","userObjects","room","ERR_NOT_OWNER","size","ERR_FULL","pushByName","OK","cancelOrder","orderId","deal","targetRoomName","order","roundCredits","user","subscriptionTokens","terminal","find","transferCost","RESOURCE_ENERGY","cooldownTime","time","ERR_TIRED","money","changeOrderPrice","newPrice","remainingAmount","extendOrder","addAmount","Object","defineProperties","enumerable","get","incomingTransactions","map","transactions","incoming","i","transactionId","_id","sender","username","users","undefined","recipient","outgoingTransactions","outgoing","myOrders","indexBy","value"],"mappings":"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","file":"../../game/market.js","sourceRoot":"/src"}