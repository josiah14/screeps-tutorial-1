{"version":3,"sources":["processor/market.js"],"names":["q","require","_","utils","driver","getDriver","C","constants","module","exports","execute","market","gameTime","terminals","bulkObjects","bulkUsers","bulkUsersWrite","bulkTransactions","bulkTransactionsWrite","bulkUsersMoney","bulkUsersResources","bulkMarketOrders","terminalsByRoom","indexBy","executeTransfer","fromTerminal","toTerminal","resourceType","amount","transferFeeTerminal","additionalFields","user","targetResourceTotal","calcResources","freeSpace","Math","max","energyCapacity","min","range","calcRoomsDistance","room","transferCost","calcTerminalEnergyCost","RESOURCE_ENERGY","energy","update","insert","extend","time","sender","undefined","recipient","from","to","filter","i","send","forEach","intent","terminal","cooldownTime","targetRoomName","description","replace","TERMINAL_COOLDOWN","usersById","users","ordersById","orders","terminalDeals","directDeals","intents","userIntents","createOrder","price","totalAmount","contains","RESOURCES_ALL","SUBSCRIPTION_TOKEN","roomName","fee","roundCredits","MARKET_FEE","money","created","active","type","ORDER_SELL","ORDER_BUY","remainingAmount","date","Date","tick","balance","change","order","changeOrderPrice","orderId","newPrice","oldPrice","_id","extendOrder","addAmount","cancelOrder","_cancelled","deal","push","sort","a","b","orderTerminal","targetTerminal","buyer","seller","targetFreeSpace","dealCost","ceil","floor","id","npc","shuffle","userFieldName","marketOrderId","anotherUser","remove","availableResourceAmount","subscriptionTokens","userMoney","isOwner","newAmount","newActive","all","clearMarketIntents"],"mappings":"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","file":"../../processor/market.js","sourceRoot":"/src"}